<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>üì± P2P –ú–µ—Å—Å–µ–Ω–¥–∂–µ—Ä PRO</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }
        
        body {
            background: #0f172a;
            color: white;
            height: 100vh;
            overflow: hidden;
        }
        
        /* –ü—Ä–∏–ª–æ–∂–µ–Ω–∏–µ */
        .app {
            display: flex;
            height: 100vh;
            max-width: 1600px;
            margin: 0 auto;
        }
        
        /* –õ–µ–≤–∞—è –ø–∞–Ω–µ–ª—å */
        .sidebar {
            width: 300px;
            background: #1e293b;
            border-right: 1px solid #334155;
            display: flex;
            flex-direction: column;
        }
        
        .user-panel {
            padding: 20px;
            border-bottom: 1px solid #334155;
        }
        
        .user-info {
            display: flex;
            align-items: center;
            gap: 15px;
            margin-bottom: 15px;
        }
        
        .user-avatar {
            width: 60px;
            height: 60px;
            background: linear-gradient(135deg, #3b82f6, #1d4ed8);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
            font-size: 24px;
            cursor: pointer;
        }
        
        .user-details {
            flex: 1;
        }
        
        .user-name {
            font-size: 18px;
            font-weight: bold;
            margin-bottom: 5px;
        }
        
        .user-id {
            background: rgba(59, 130, 246, 0.2);
            padding: 5px 10px;
            border-radius: 8px;
            font-size: 12px;
            font-family: monospace;
            border: 1px solid #3b82f6;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: space-between;
        }
        
        .copy-btn {
            background: none;
            border: none;
            color: #94a3b8;
            cursor: pointer;
            padding: 2px;
        }
        
        /* –ú–µ–Ω—é */
        .menu {
            padding: 20px;
        }
        
        .menu-item {
            display: flex;
            align-items: center;
            gap: 12px;
            padding: 12px 15px;
            margin-bottom: 8px;
            border-radius: 10px;
            cursor: pointer;
            transition: all 0.3s ease;
        }
        
        .menu-item:hover {
            background: rgba(255, 255, 255, 0.1);
        }
        
        .menu-item.active {
            background: rgba(59, 130, 246, 0.2);
            color: #3b82f6;
            border-left: 3px solid #3b82f6;
        }
        
        .menu-icon {
            width: 20px;
            text-align: center;
        }
        
        /* –ß–∞—Ç—ã */
        .chats-section {
            flex: 1;
            overflow-y: auto;
            padding: 10px;
        }
        
        .chat-item {
            display: flex;
            align-items: center;
            gap: 15px;
            padding: 15px;
            margin-bottom: 10px;
            background: rgba(255, 255, 255, 0.05);
            border-radius: 10px;
            cursor: pointer;
            transition: all 0.3s ease;
        }
        
        .chat-item:hover {
            background: rgba(255, 255, 255, 0.1);
            transform: translateX(5px);
        }
        
        .chat-item.active {
            background: rgba(59, 130, 246, 0.2);
            border: 1px solid #3b82f6;
        }
        
        .chat-avatar {
            width: 45px;
            height: 45px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
            font-size: 18px;
        }
        
        .personal .chat-avatar {
            background: linear-gradient(135deg, #10b981, #059669);
        }
        
        .group .chat-avatar {
            background: linear-gradient(135deg, #8b5cf6, #7c3aed);
        }
        
        .chat-info {
            flex: 1;
        }
        
        .chat-name {
            font-weight: 600;
            margin-bottom: 3px;
        }
        
        .chat-last {
            font-size: 12px;
            color: #94a3b8;
        }
        
        /* –ß–∞—Ç */
        .chat-area {
            flex: 1;
            display: flex;
            flex-direction: column;
            background: #0f172a;
        }
        
        .chat-header {
            padding: 20px;
            background: #1e293b;
            border-bottom: 1px solid #334155;
            display: flex;
            align-items: center;
            justify-content: space-between;
        }
        
        .chat-with {
            display: flex;
            align-items: center;
            gap: 15px;
        }
        
        .chat-actions {
            display: flex;
            gap: 10px;
        }
        
        .action-btn {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            border: none;
            background: #475569;
            color: white;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        
        .action-btn:hover {
            background: #64748b;
        }
        
        .action-btn.primary {
            background: #3b82f6;
        }
        
        .messages {
            flex: 1;
            padding: 20px;
            overflow-y: auto;
            display: flex;
            flex-direction: column;
            gap: 15px;
        }
        
        .message {
            max-width: 70%;
            padding: 12px 16px;
            border-radius: 18px;
            animation: fadeIn 0.3s ease;
        }
        
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }
        
        .message.in {
            background: #1e293b;
            align-self: flex-start;
        }
        
        .message.out {
            background: #1e40af;
            align-self: flex-end;
        }
        
        .message-info {
            display: flex;
            justify-content: space-between;
            font-size: 11px;
            color: rgba(255, 255, 255, 0.6);
            margin-top: 5px;
        }
        
        .input-area {
            padding: 20px;
            background: #1e293b;
            border-top: 1px solid #334155;
        }
        
        .input-container {
            display: flex;
            gap: 10px;
        }
        
        .message-input {
            flex: 1;
            padding: 15px 20px;
            background: #334155;
            border: 1px solid #475569;
            border-radius: 25px;
            color: white;
            font-size: 16px;
            outline: none;
        }
        
        .message-input:focus {
            border-color: #3b82f6;
        }
        
        .send-btn {
            width: 50px;
            height: 50px;
            border-radius: 50%;
            background: #3b82f6;
            color: white;
            border: none;
            cursor: pointer;
            font-size: 18px;
        }
        
        .send-btn:hover {
            background: #2563eb;
        }
        
        /* –ù–∞—Å—Ç—Ä–æ–π–∫–∏ */
        .settings-panel {
            width: 400px;
            background: #1e293b;
            border-left: 1px solid #334155;
            display: flex;
            flex-direction: column;
        }
        
        .settings-header {
            padding: 20px;
            border-bottom: 1px solid #334155;
            display: flex;
            align-items: center;
            justify-content: space-between;
        }
        
        .settings-content {
            flex: 1;
            padding: 20px;
            overflow-y: auto;
        }
        
        .settings-section {
            margin-bottom: 30px;
        }
        
        .settings-section h3 {
            color: #3b82f6;
            margin-bottom: 15px;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .setting-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 15px;
            background: rgba(255, 255, 255, 0.05);
            border-radius: 10px;
            margin-bottom: 10px;
        }
        
        .setting-item label {
            flex: 1;
        }
        
        .setting-item small {
            display: block;
            color: #94a3b8;
            font-size: 12px;
            margin-top: 5px;
        }
        
        select, input[type="range"], input[type="text"], input[type="color"] {
            background: #334155;
            border: 1px solid #475569;
            border-radius: 6px;
            color: white;
            padding: 8px 12px;
            margin-top: 5px;
        }
        
        input[type="range"] {
            width: 100%;
        }
        
        .color-picker {
            display: flex;
            gap: 10px;
            align-items: center;
        }
        
        .theme-preview {
            width: 60px;
            height: 30px;
            border-radius: 6px;
            border: 2px solid #475569;
            cursor: pointer;
        }
        
        /* –ó–≤–æ–Ω–∫–∏ */
        .call-panel {
            display: none;
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: #1e293b;
            padding: 30px;
            border-radius: 20px;
            border: 2px solid #3b82f6;
            z-index: 1000;
            text-align: center;
            min-width: 300px;
        }
        
        .call-panel.active {
            display: block;
        }
        
        /* –ú–æ–¥–∞–ª—å–Ω—ã–µ –æ–∫–Ω–∞ */
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.8);
            z-index: 2000;
            align-items: center;
            justify-content: center;
        }
        
        .modal.active {
            display: flex;
        }
        
        .modal-content {
            background: #1e293b;
            padding: 30px;
            border-radius: 15px;
            width: 90%;
            max-width: 500px;
            border: 2px solid #3b82f6;
        }
        
        /* –£–≤–µ–¥–æ–º–ª–µ–Ω–∏—è */
        .notification {
            position: fixed;
            bottom: 20px;
            right: 20px;
            background: #10b981;
            color: white;
            padding: 15px 25px;
            border-radius: 10px;
            display: none;
            z-index: 3000;
        }
        
        .notification.show {
            display: block;
            animation: slideIn 0.3s ease;
        }
        
        @keyframes slideIn {
            from { transform: translateX(100px); opacity: 0; }
            to { transform: translateX(0); opacity: 1; }
        }
        
        /* –ü—É—Å—Ç–æ–π —á–∞—Ç */
        .empty-chat {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            height: 100%;
            color: #94a3b8;
            text-align: center;
            padding: 20px;
        }
        
        .add-chat-btn {
            position: fixed;
            bottom: 30px;
            right: 30px;
            width: 60px;
            height: 60px;
            border-radius: 50%;
            background: #3b82f6;
            color: white;
            border: none;
            font-size: 24px;
            cursor: pointer;
            box-shadow: 0 4px 15px rgba(59, 130, 246, 0.4);
        }
        
        .add-chat-btn:hover {
            background: #2563eb;
            transform: scale(1.1);
        }
    </style>
</head>
<body>
    <div class="app">
        <!-- –õ–µ–≤–∞—è –ø–∞–Ω–µ–ª—å -->
        <div class="sidebar">
            <div class="user-panel">
                <div class="user-info" onclick="showSettings()">
                    <div class="user-avatar" id="userAvatar">–Ø</div>
                    <div class="user-details">
                        <div class="user-name" id="userName">–í—ã</div>
                        <div class="user-id" id="userId" onclick="copyMyId(event)">
                            ID: <span id="idText">–ó–∞–≥—Ä—É–∑–∫–∞...</span>
                            <button class="copy-btn">üìã</button>
                        </div>
                    </div>
                </div>
            </div>
            
            <div class="menu">
                <div class="menu-item active" onclick="switchMenu('chats')">
                    <span class="menu-icon">üí¨</span>
                    <span>–ß–∞—Ç—ã</span>
                </div>
                <div class="menu-item" onclick="switchMenu('contacts')">
                    <span class="menu-icon">üë•</span>
                    <span>–ö–æ–Ω—Ç–∞–∫—Ç—ã</span>
                </div>
                <div class="menu-item" onclick="switchMenu('groups')">
                    <span class="menu-icon">üë®‚Äçüë©‚Äçüëß‚Äçüë¶</span>
                    <span>–ì—Ä—É–ø–ø—ã</span>
                </div>
                <div class="menu-item" onclick="showSettings()">
                    <span class="menu-icon">‚öôÔ∏è</span>
                    <span>–ù–∞—Å—Ç—Ä–æ–π–∫–∏</span>
                </div>
            </div>
            
            <div class="chats-section" id="chatsList">
                <!-- –°–ø–∏—Å–æ–∫ —á–∞—Ç–æ–≤ -->
            </div>
        </div>

        <!-- –¶–µ–Ω—Ç—Ä–∞–ª—å–Ω–∞—è –æ–±–ª–∞—Å—Ç—å - —á–∞—Ç -->
        <div class="chat-area" id="chatArea">
            <div class="chat-header">
                <div class="chat-with">
                    <div class="chat-avatar personal" id="chatAvatar">–ß</div>
                    <div>
                        <h3 id="chatTitle">–í—ã–±–µ—Ä–∏—Ç–µ —á–∞—Ç</h3>
                        <div id="chatStatus" style="font-size: 14px; color: #94a3b8;">
                            –ù–∞—á–Ω–∏—Ç–µ –æ–±—â–µ–Ω–∏–µ
                        </div>
                    </div>
                </div>
                
                <div class="chat-actions" id="chatActions" style="display: none;">
                    <button class="action-btn" onclick="toggleSettings()">‚öôÔ∏è</button>
                    <button class="action-btn primary" onclick="startCall()">üìû</button>
                    <button class="action-btn" onclick="clearChat()">üóëÔ∏è</button>
                </div>
            </div>
            
            <div class="messages" id="messages">
                <div class="empty-chat">
                    <h3>üëã –î–æ–±—Ä–æ –ø–æ–∂–∞–ª–æ–≤–∞—Ç—å –≤ P2P –ú–µ—Å—Å–µ–Ω–¥–∂–µ—Ä!</h3>
                    <p>–í–∞—à ID: <strong id="welcomeId">...</strong></p>
                    <p style="margin-top: 20px;">–û—Ç–ø—Ä–∞–≤—å—Ç–µ —ç—Ç–æ—Ç ID –¥—Ä—É–≥—É –¥–ª—è –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è</p>
                </div>
            </div>
            
            <div class="input-area" id="inputArea" style="display: none;">
                <div class="input-container">
                    <input type="text" class="message-input" id="messageInput" 
                           placeholder="–í–≤–µ–¥–∏—Ç–µ —Å–æ–æ–±—â–µ–Ω–∏–µ..." 
                           onkeypress="if(event.key === 'Enter') sendMessage()">
                    <button class="send-btn" onclick="sendMessage()">‚û§</button>
                </div>
            </div>
        </div>

        <!-- –ü—Ä–∞–≤–∞—è –ø–∞–Ω–µ–ª—å - –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ -->
        <div class="settings-panel" id="settingsPanel" style="display: none;">
            <div class="settings-header">
                <h2>‚öôÔ∏è –ù–∞—Å—Ç—Ä–æ–π–∫–∏</h2>
                <button class="action-btn" onclick="toggleSettings()">‚úï</button>
            </div>
            
            <div class="settings-content">
                <!-- –ü—Ä–æ—Ñ–∏–ª—å -->
                <div class="settings-section">
                    <h3>üë§ –ü—Ä–æ—Ñ–∏–ª—å</h3>
                    <div class="setting-item">
                        <div>
                            <label>–í–∞—à–µ –∏–º—è</label>
                            <input type="text" id="profileName" value="–í—ã" style="width: 100%; margin-top: 8px;">
                        </div>
                    </div>
                    <div class="setting-item">
                        <div>
                            <label>–°—Ç–∞—Ç—É—Å</label>
                            <input type="text" id="profileStatus" value="–í —Å–µ—Ç–∏" style="width: 100%; margin-top: 8px;">
                        </div>
                    </div>
                    <button class="action-btn primary" onclick="saveProfile()" style="width: 100%; margin-top: 10px;">
                        –°–æ—Ö—Ä–∞–Ω–∏—Ç—å
                    </button>
                </div>
                
                <!-- –í–Ω–µ—à–Ω–∏–π –≤–∏–¥ -->
                <div class="settings-section">
                    <h3>üé® –í–Ω–µ—à–Ω–∏–π –≤–∏–¥</h3>
                    <div class="setting-item">
                        <label>
                            –¢–µ–º–∞
                            <small>–í—ã–±–µ—Ä–∏—Ç–µ —Ü–≤–µ—Ç–æ–≤—É—é —Å—Ö–µ–º—É</small>
                        </label>
                        <select id="themeSelect">
                            <option value="dark">–¢—ë–º–Ω–∞—è</option>
                            <option value="blue">–°–∏–Ω—è—è</option>
                            <option value="purple">–§–∏–æ–ª–µ—Ç–æ–≤–∞—è</option>
                            <option value="green">–ó–µ–ª—ë–Ω–∞—è</option>
                        </select>
                    </div>
                    <div class="setting-item">
                        <label>
                            –†–∞–∑–º–µ—Ä —à—Ä–∏—Ñ—Ç–∞
                            <small>–ù–∞—Å—Ç—Ä–æ–π—Ç–µ —É–¥–æ–±–Ω—ã–π —Ä–∞–∑–º–µ—Ä —Ç–µ–∫—Å—Ç–∞</small>
                        </label>
                        <input type="range" id="fontSize" min="12" max="20" value="16">
                    </div>
                    <div class="setting-item">
                        <label>
                            –ü–ª–æ—Ç–Ω–æ—Å—Ç—å —Å–æ–æ–±—â–µ–Ω–∏–π
                            <small>–†–∞—Å—Å—Ç–æ—è–Ω–∏–µ –º–µ–∂–¥—É —Å–æ–æ–±—â–µ–Ω–∏—è–º–∏</small>
                        </label>
                        <select id="messageSpacing">
                            <option value="compact">–ö–æ–º–ø–∞–∫—Ç–Ω–æ</option>
                            <option value="normal" selected>–ù–æ—Ä–º–∞–ª—å–Ω–æ</option>
                            <option value="comfortable">–ö–æ–º—Ñ–æ—Ä—Ç–Ω–æ</option>
                        </select>
                    </div>
                </div>
                
                <!-- –£–≤–µ–¥–æ–º–ª–µ–Ω–∏—è -->
                <div class="settings-section">
                    <h3>üîî –£–≤–µ–¥–æ–º–ª–µ–Ω–∏—è</h3>
                    <div class="setting-item">
                        <label>
                            –ó–≤—É–∫ —Å–æ–æ–±—â–µ–Ω–∏–π
                            <small>–í–∫–ª—é—á–∏—Ç—å –∑–≤—É–∫–æ–≤—ã–µ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è</small>
                        </label>
                        <label class="switch">
                            <input type="checkbox" id="soundToggle" checked>
                            <span class="slider"></span>
                        </label>
                    </div>
                    <div class="setting-item">
                        <label>
                            –í–∏–±—Ä–æ—Å–∏–≥–Ω–∞–ª
                            <small>–í–∏–±—Ä–∞—Ü–∏—è –ø—Ä–∏ –Ω–æ–≤—ã—Ö —Å–æ–æ–±—â–µ–Ω–∏—è—Ö</small>
                        </label>
                        <label class="switch">
                            <input type="checkbox" id="vibrateToggle" checked>
                            <span class="slider"></span>
                        </label>
                    </div>
                    <div class="setting-item">
                        <label>
                            –ü–æ–∫–∞–∑—ã–≤–∞—Ç—å –ø—Ä–µ–¥–ø—Ä–æ—Å–º–æ—Ç—Ä
                            <small>–ü–æ–∫–∞–∑—ã–≤–∞—Ç—å —Ç–µ–∫—Å—Ç —Å–æ–æ–±—â–µ–Ω–∏—è –≤ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–∏</small>
                        </label>
                        <label class="switch">
                            <input type="checkbox" id="previewToggle" checked>
                            <span class="slider"></span>
                        </label>
                    </div>
                </div>
                
                <!-- –ö–æ–Ω—Ñ–∏–¥–µ–Ω—Ü–∏–∞–ª—å–Ω–æ—Å—Ç—å -->
                <div class="settings-section">
                    <h3>üîí –ö–æ–Ω—Ñ–∏–¥–µ–Ω—Ü–∏–∞–ª—å–Ω–æ—Å—Ç—å</h3>
                    <div class="setting-item">
                        <label>
                            –°—Ç–∞—Ç—É—Å –æ–Ω–ª–∞–π–Ω
                            <small>–ü–æ–∫–∞–∑—ã–≤–∞—Ç—å –¥—Ä—É–≥–∏–º, —á—Ç–æ –≤—ã –≤ —Å–µ—Ç–∏</small>
                        </label>
                        <label class="switch">
                            <input type="checkbox" id="onlineStatusToggle" checked>
                            <span class="slider"></span>
                        </label>
                    </div>
                    <div class="setting-item">
                        <label>
                            –ü–æ—Å–ª–µ–¥–Ω–∏–π —Ä–∞–∑ –≤ —Å–µ—Ç–∏
                            <small>–ü–æ–∫–∞–∑—ã–≤–∞—Ç—å –≤—Ä–µ–º—è –ø–æ—Å–ª–µ–¥–Ω–µ–π –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç–∏</small>
                        </label>
                        <label class="switch">
                            <input type="checkbox" id="lastSeenToggle" checked>
                            <span class="slider"></span>
                        </label>
                    </div>
                    <div class="setting-item">
                        <label>
                            –ü—Ä–æ—á–∏—Ç–∞–Ω–Ω—ã–µ —Å–æ–æ–±—â–µ–Ω–∏—è
                            <small>–ü–æ–∫–∞–∑—ã–≤–∞—Ç—å –æ—Ç–º–µ—Ç–∫–∏ –æ –ø—Ä–æ—á—Ç–µ–Ω–∏–∏</small>
                        </label>
                        <label class="switch">
                            <input type="checkbox" id="readReceiptsToggle" checked>
                            <span class="slider"></span>
                        </label>
                    </div>
                </div>
                
                <!-- –ì–æ–ª–æ—Å–æ–≤—ã–µ –∑–≤–æ–Ω–∫–∏ -->
                <div class="settings-section">
                    <h3>üìû –ó–≤–æ–Ω–∫–∏</h3>
                    <div class="setting-item">
                        <label>
                            –ê–≤—Ç–æ–ø—Ä–∏–Ω—è—Ç–∏–µ –∑–≤–æ–Ω–∫–æ–≤
                            <small>–ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –ø—Ä–∏–Ω–∏–º–∞—Ç—å –≤—Ö–æ–¥—è—â–∏–µ –∑–≤–æ–Ω–∫–∏</small>
                        </label>
                        <label class="switch">
                            <input type="checkbox" id="autoAnswerToggle">
                            <span class="slider"></span>
                        </label>
                    </div>
                    <div class="setting-item">
                        <label>
                            –ü–æ–¥–∞–≤–ª–µ–Ω–∏–µ —à—É–º–∞
                            <small>–£–ª—É—á—à–µ–Ω–∏–µ –∫–∞—á–µ—Å—Ç–≤–∞ –∑–≤—É–∫–∞</small>
                        </label>
                        <label class="switch">
                            <input type="checkbox" id="noiseSuppressionToggle" checked>
                            <span class="slider"></span>
                        </label>
                    </div>
                    <div class="setting-item">
                        <label>
                            –≠—Ö–æ–ø–æ–¥–∞–≤–ª–µ–Ω–∏–µ
                            <small>–£—Å—Ç—Ä–∞–Ω–µ–Ω–∏–µ —ç—Ö–∞ –≤–æ –≤—Ä–µ–º—è –∑–≤–æ–Ω–∫–∞</small>
                        </label>
                        <label class="switch">
                            <input type="checkbox" id="echoCancellationToggle" checked>
                            <span class="slider"></span>
                        </label>
                    </div>
                </div>
                
                <!-- –î–∞–Ω–Ω—ã–µ –∏ —Ö—Ä–∞–Ω–∏–ª–∏—â–µ -->
                <div class="settings-section">
                    <h3>üíæ –î–∞–Ω–Ω—ã–µ</h3>
                    <div class="setting-item">
                        <label>
                            –ê–≤—Ç–æ—É–¥–∞–ª–µ–Ω–∏–µ —Å–æ–æ–±—â–µ–Ω–∏–π
                            <small>–£–¥–∞–ª—è—Ç—å —Å—Ç–∞—Ä—ã–µ —Å–æ–æ–±—â–µ–Ω–∏—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏</small>
                            <select id="autoDelete" style="width: 100%; margin-top: 8px;">
                                <option value="never">–ù–∏–∫–æ–≥–¥–∞</option>
                                <option value="week">–ß–µ—Ä–µ–∑ 1 –Ω–µ–¥–µ–ª—é</option>
                                <option value="month">–ß–µ—Ä–µ–∑ 1 –º–µ—Å—è—Ü</option>
                                <option value="3months">–ß–µ—Ä–µ–∑ 3 –º–µ—Å—è—Ü–∞</option>
                            </select>
                        </label>
                    </div>
                    <div class="setting-item">
                        <label>
                            –°–æ—Ö—Ä–∞–Ω—è—Ç—å –º–µ–¥–∏–∞
                            <small>–ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —Å–æ—Ö—Ä–∞–Ω—è—Ç—å —Ñ–æ—Ç–æ –∏ –≤–∏–¥–µ–æ</small>
                        </label>
                        <label class="switch">
                            <input type="checkbox" id="saveMediaToggle">
                            <span class="slider"></span>
                        </label>
                    </div>
                    <div class="setting-item">
                        <label>
                            –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö
                            <small>–û–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–µ –¥–ª—è –º–æ–±–∏–ª—å–Ω—ã—Ö —Å–µ—Ç–µ–π</small>
                            <select id="dataUsage" style="width: 100%; margin-top: 8px;">
                                <option value="high">–í—ã—Å–æ–∫–æ–µ –∫–∞—á–µ—Å—Ç–≤–æ</option>
                                <option value="normal" selected>–ù–æ—Ä–º–∞–ª—å–Ω–æ–µ</option>
                                <option value="low">–≠–∫–æ–Ω–æ–º–Ω—ã–π —Ä–µ–∂–∏–º</option>
                            </select>
                        </label>
                    </div>
                </div>
                
                <!-- –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–æ -->
                <div class="settings-section">
                    <h3>‚ö° –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–æ</h3>
                    <div class="setting-item">
                        <button class="action-btn" onclick="exportData()" style="width: 100%;">
                            üì§ –≠–∫—Å–ø–æ—Ä—Ç –¥–∞–Ω–Ω—ã—Ö
                        </button>
                    </div>
                    <div class="setting-item">
                        <button class="action-btn" onclick="clearAllData()" style="width: 100%; background: #ef4444;">
                            üóëÔ∏è –û—á–∏—Å—Ç–∏—Ç—å –≤—Å—ë
                        </button>
                    </div>
                    <div class="setting-item">
                        <button class="action-btn" onclick="showAbout()" style="width: 100%; background: #8b5cf6;">
                            ‚ÑπÔ∏è –û –ø—Ä–æ–≥—Ä–∞–º–º–µ
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- –ö–Ω–æ–ø–∫–∞ –¥–æ–±–∞–≤–ª–µ–Ω–∏—è -->
    <button class="add-chat-btn" onclick="showAddModal()">+</button>

    <!-- –ú–æ–¥–∞–ª—å–Ω—ã–µ –æ–∫–Ω–∞ -->
    <div class="modal" id="addModal">
        <div class="modal-content">
            <h3 style="margin-bottom: 20px;">‚ûï –î–æ–±–∞–≤–∏—Ç—å</h3>
            <button class="action-btn primary" onclick="showAddContactModal()" style="width: 100%; margin-bottom: 10px; padding: 15px;">
                üë§ –ù–æ–≤—ã–π –∫–æ–Ω—Ç–∞–∫—Ç
            </button>
            <button class="action-btn primary" onclick="showCreateGroupModal()" style="width: 100%; margin-bottom: 10px; padding: 15px;">
                üë®‚Äçüë©‚Äçüëß‚Äçüë¶ –ù–æ–≤–∞—è –≥—Ä—É–ø–ø–∞
            </button>
            <button class="action-btn" onclick="hideModal()" style="width: 100%; padding: 15px;">
                –û—Ç–º–µ–Ω–∞
            </button>
        </div>
    </div>
    
    <div class="modal" id="addContactModal">
        <div class="modal-content">
            <h3>üë§ –î–æ–±–∞–≤–∏—Ç—å –∫–æ–Ω—Ç–∞–∫—Ç</h3>
            <input type="text" class="message-input" id="contactId" placeholder="ID –¥—Ä—É–≥–∞" style="width: 100%; margin: 15px 0;">
            <input type="text" class="message-input" id="contactName" placeholder="–ò–º—è (–Ω–µ–æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ)" style="width: 100%; margin-bottom: 20px;">
            <div style="display: flex; gap: 10px;">
                <button class="action-btn" onclick="hideModal()" style="flex: 1;">–û—Ç–º–µ–Ω–∞</button>
                <button class="action-btn primary" onclick="addContact()" style="flex: 1;">–î–æ–±–∞–≤–∏—Ç—å</button>
            </div>
        </div>
    </div>
    
    <div class="modal" id="createGroupModal">
        <div class="modal-content">
            <h3>üë®‚Äçüë©‚Äçüëß‚Äçüë¶ –°–æ–∑–¥–∞—Ç—å –≥—Ä—É–ø–ø—É</h3>
            <input type="text" class="message-input" id="groupName" placeholder="–ù–∞–∑–≤–∞–Ω–∏–µ –≥—Ä—É–ø–ø—ã" style="width: 100%; margin: 15px 0;">
            <textarea class="message-input" id="groupMembers" placeholder="ID —É—á–∞—Å—Ç–Ω–∏–∫–æ–≤ (—á–µ—Ä–µ–∑ –∑–∞–ø—è—Ç—É—é)" style="width: 100%; height: 100px; margin-bottom: 20px;"></textarea>
            <div style="display: flex; gap: 10px;">
                <button class="action-btn" onclick="hideModal()" style="flex: 1;">–û—Ç–º–µ–Ω–∞</button>
                <button class="action-btn primary" onclick="createGroup()" style="flex: 1;">–°–æ–∑–¥–∞—Ç—å</button>
            </div>
        </div>
    </div>
    
    <div class="modal" id="aboutModal">
        <div class="modal-content">
            <h3>‚ÑπÔ∏è –û –ø—Ä–æ–≥—Ä–∞–º–º–µ</h3>
            <div style="margin: 20px 0;">
                <p><strong>P2P –ú–µ—Å—Å–µ–Ω–¥–∂–µ—Ä PRO</strong></p>
                <p>–í–µ—Ä—Å–∏—è: 2.0.0</p>
                <p>–†–∞–∑—Ä–∞–±–æ—Ç—á–∏–∫: P2P Team</p>
                <p>–õ–∏—Ü–µ–Ω–∑–∏—è: MIT</p>
                <p style="margin-top: 15px;">–ë–µ—Å–ø–ª–∞—Ç–Ω—ã–π –º–µ—Å—Å–µ–Ω–¥–∂–µ—Ä —Å P2P —Ç–µ—Ö–Ω–æ–ª–æ–≥–∏–µ–π</p>
                <p>–í—Å–µ —Å–æ–æ–±—â–µ–Ω–∏—è —à–∏—Ñ—Ä—É—é—Ç—Å—è end-to-end</p>
            </div>
            <button class="action-btn" onclick="hideModal()" style="width: 100%;">–ó–∞–∫—Ä—ã—Ç—å</button>
        </div>
    </div>

    <!-- –ó–≤–æ–Ω–æ–∫ -->
    <div class="call-panel" id="callPanel">
        <h3 style="margin-bottom: 10px;">üìû –ó–≤–æ–Ω–æ–∫</h3>
        <div id="callTo" style="margin-bottom: 20px;">–î—Ä—É–≥—É</div>
        <div id="callTimer" style="font-size: 32px; font-weight: bold; margin: 20px 0;">00:00</div>
        <div style="display: flex; gap: 10px;">
            <button class="action-btn primary" onclick="acceptCall()" style="flex: 1;">–ü—Ä–∏–Ω—è—Ç—å</button>
            <button class="action-btn" onclick="toggleMute()" style="flex: 1;">üé§</button>
            <button class="action-btn" onclick="endCall()" style="flex: 1; background: #ef4444;">–°–±—Ä–æ—Å–∏—Ç—å</button>
        </div>
    </div>

    <!-- –£–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ -->
    <div class="notification" id="notification">
        <span id="notificationText">–£–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ</span>
    </div>

    <script>
        // ========== –î–ê–ù–ù–´–ï ==========
        let myId = null;
        let myName = "–í—ã";
        let contacts = [];
        let groups = [];
        let chats = [];
        let currentChat = null;
        let messages = {};
        
        // –ù–∞—Å—Ç—Ä–æ–π–∫–∏ –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é
        let settings = {
            theme: 'dark',
            fontSize: 16,
            sound: true,
            vibrate: true,
            onlineStatus: true,
            readReceipts: true,
            autoAnswer: false,
            noiseSuppression: true,
            echoCancellation: true,
            autoDelete: 'never',
            saveMedia: false,
            dataUsage: 'normal'
        };
        
        // ========== –ò–ù–ò–¶–ò–ê–õ–ò–ó–ê–¶–ò–Ø ==========
        function init() {
            // –ì–µ–Ω–µ—Ä–∏—Ä—É–µ–º ID —Å—Ä–∞–∑—É (–±–µ–∑ PeerJS –¥–ª—è –ø—Ä–æ—Å—Ç–æ—Ç—ã)
            generateMyId();
            
            // –ó–∞–≥—Ä—É–∂–∞–µ–º –¥–∞–Ω–Ω—ã–µ
            loadData();
            
            // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º ID
            updateMyIdDisplay();
            
            // –î–æ–±–∞–≤–ª—è–µ–º —Ç–µ—Å—Ç–æ–≤—ã–µ –¥–∞–Ω–Ω—ã–µ
            setTimeout(() => {
                addTestData();
                showNotification('‚úÖ P2P –ú–µ—Å—Å–µ–Ω–¥–∂–µ—Ä –∑–∞–≥—Ä—É–∂–µ–Ω!');
            }, 500);
        }
        
        function generateMyId() {
            // –ì–µ–Ω–µ—Ä–∏—Ä—É–µ–º —Å–ª—É—á–∞–π–Ω—ã–π ID
            const chars = 'ABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789';
            let id = 'USER-';
            for (let i = 0; i < 8; i++) {
                id += chars.charAt(Math.floor(Math.random() * chars.length));
            }
            myId = id;
        }
        
        function loadData() {
            // –ó–∞–≥—Ä—É–∂–∞–µ–º –∏–∑ localStorage
            const saved = localStorage.getItem('p2p-messenger-data');
            if (saved) {
                const data = JSON.parse(saved);
                contacts = data.contacts || [];
                groups = data.groups || [];
                messages = data.messages || {};
                settings = data.settings || settings;
                myName = data.myName || myName;
            }
            
            // –ü—Ä–∏–º–µ–Ω—è–µ–º –Ω–∞—Å—Ç—Ä–æ–π–∫–∏
            applySettings();
        }
        
        function saveData() {
            const data = {
                contacts,
                groups,
                messages,
                settings,
                myName
            };
            localStorage.setItem('p2p-messenger-data', JSON.stringify(data));
        }
        
        function applySettings() {
            // –ü—Ä–∏–º–µ–Ω—è–µ–º —Ç–µ–º—É
            document.documentElement.setAttribute('data-theme', settings.theme);
            
            // –ü—Ä–∏–º–µ–Ω—è–µ–º —Ä–∞–∑–º–µ—Ä —à—Ä–∏—Ñ—Ç–∞
            document.documentElement.style.fontSize = settings.fontSize + 'px';
            
            // –û–±–Ω–æ–≤–ª—è–µ–º UI –Ω–∞—Å—Ç—Ä–æ–µ–∫
            updateSettingsUI();
        }
        
        function updateSettingsUI() {
            document.getElementById('themeSelect').value = settings.theme;
            document.getElementById('fontSize').value = settings.fontSize;
            document.getElementById('soundToggle').checked = settings.sound;
            document.getElementById('vibrateToggle').checked = settings.vibrate;
            document.getElementById('onlineStatusToggle').checked = settings.onlineStatus;
            document.getElementById('readReceiptsToggle').checked = settings.readReceipts;
            document.getElementById('autoAnswerToggle').checked = settings.autoAnswer;
            document.getElementById('noiseSuppressionToggle').checked = settings.noiseSuppression;
            document.getElementById('echoCancellationToggle').checked = settings.echoCancellation;
            document.getElementById('autoDelete').value = settings.autoDelete;
            document.getElementById('saveMediaToggle').checked = settings.saveMedia;
            document.getElementById('dataUsage').value = settings.dataUsage;
            document.getElementById('profileName').value = myName;
        }
        
        // ========== –¢–ï–°–¢–û–í–´–ï –î–ê–ù–ù–´–ï ==========
        function addTestData() {
            if (contacts.length === 0) {
                contacts.push({
                    id: 'TEST123',
                    name: '–î—Ä—É–≥ 1',
                    avatar: '–î',
                    online: true
                });
                
                contacts.push({
                    id: 'TEST456',
                    name: '–î—Ä—É–≥ 2',
                    avatar: '–ü',
                    online: false
                });
            }
            
            if (groups.length === 0) {
                groups.push({
                    id: 'GRP001',
                    name: '–ì—Ä—É–ø–ø–∞ –¥—Ä—É–∑–µ–π',
                    avatar: '–ì',
                    members: ['–í—ã', '–î—Ä—É–≥ 1', '–î—Ä—É–≥ 2'],
                    online: 3
                });
            }
            
            // –¢–µ—Å—Ç–æ–≤—ã–µ —Å–æ–æ–±—â–µ–Ω–∏—è
            if (!messages['TEST123']) {
                messages['TEST123'] = [
                    { text: '–ü—Ä–∏–≤–µ—Ç! –ö–∞–∫ –¥–µ–ª–∞?', sender: '–î—Ä—É–≥ 1', time: '10:30', isMe: false },
                    { text: '–ü—Ä–∏–≤–µ—Ç! –í—Å—ë –æ—Ç–ª–∏—á–Ω–æ!', sender: myName, time: '10:31', isMe: true },
                    { text: '–•–æ—á–µ—à—å –ø–æ–∑–≤–æ–Ω–∏—Ç—å?', sender: '–î—Ä—É–≥ 1', time: '10:32', isMe: false }
                ];
            }
            
            if (!messages['GRP001']) {
                messages['GRP001'] = [
                    { text: '–í—Å–µ–º –ø—Ä–∏–≤–µ—Ç!', sender: '–î—Ä—É–≥ 1', time: '10:00', isMe: false },
                    { text: '–ü—Ä–∏–≤–µ—Ç –≤—Å–µ–º!', sender: '–î—Ä—É–≥ 2', time: '10:01', isMe: false },
                    { text: '–†–∞–¥ –≤—Å–µ—Ö –≤–∏–¥–µ—Ç—å!', sender: myName, time: '10:02', isMe: true }
                ];
            }
            
            updateChatsList();
            saveData();
        }
        
        // ========== –û–¢–û–ë–†–ê–ñ–ï–ù–ò–ï ==========
        function updateMyIdDisplay() {
            document.getElementById('idText').textContent = myId;
            document.getElementById('welcomeId').textContent = myId;
        }
        
        function updateChatsList() {
            const container = document.getElementById('chatsList');
            container.innerHTML = '';
            
            // –°–æ–±–∏—Ä–∞–µ–º –≤—Å–µ —á–∞—Ç—ã
            const allChats = [];
            
            // –õ–∏—á–Ω—ã–µ —á–∞—Ç—ã
            contacts.forEach(contact => {
                const chatMessages = messages[contact.id] || [];
                const lastMsg = chatMessages[chatMessages.length - 1];
                
                allChats.push({
                    type: 'contact',
                    id: contact.id,
                    name: contact.name,
                    avatar: contact.avatar,
                    online: contact.online,
                    lastMessage: lastMsg ? lastMsg.text : '–ù–µ—Ç —Å–æ–æ–±—â–µ–Ω–∏–π',
                    lastTime: lastMsg ? lastMsg.time : ''
                });
            });
            
            // –ì—Ä—É–ø–ø–æ–≤—ã–µ —á–∞—Ç—ã
            groups.forEach(group => {
                const chatMessages = messages[group.id] || [];
                const lastMsg = chatMessages[chatMessages.length - 1];
                
                allChats.push({
                    type: 'group',
                    id: group.id,
                    name: group.name,
                    avatar: group.avatar,
                    online: group.online,
                    lastMessage: lastMsg ? `${lastMsg.sender}: ${lastMsg.text}` : '–ù–µ—Ç —Å–æ–æ–±—â–µ–Ω–∏–π',
                    lastTime: lastMsg ? lastMsg.time : ''
                });
            });
            
            // –°–æ—Ä—Ç–∏—Ä—É–µ–º –ø–æ –≤—Ä–µ–º–µ–Ω–∏
            allChats.sort((a, b) => {
                if (!a.lastTime && !b.lastTime) return 0;
                if (!a.lastTime) return 1;
                if (!b.lastTime) return -1;
                return b.lastTime.localeCompare(a.lastTime);
            });
            
            // –û—Ç–æ–±—Ä–∞–∂–∞–µ–º
            allChats.forEach(chat => {
                const div = document.createElement('div');
                div.className = `chat-item ${chat.type} ${currentChat && currentChat.id === chat.id ? 'active' : ''}`;
                div.onclick = () => selectChat(chat);
                div.innerHTML = `
                    <div class="chat-avatar">${chat.avatar}</div>
                    <div class="chat-info">
                        <div class="chat-name">${chat.name}</div>
                        <div class="chat-last">${chat.lastMessage.substring(0, 30)}${chat.lastMessage.length > 30 ? '...' : ''}</div>
                    </div>
                    ${chat.online ? '<div style="color: #10b981; font-size: 12px;">‚óè</div>' : ''}
                `;
                container.appendChild(div);
            });
        }
        
        function selectChat(chat) {
            currentChat = chat;
            
            // –û–±–Ω–æ–≤–ª—è–µ–º –∑–∞–≥–æ–ª–æ–≤–æ–∫
            document.getElementById('chatTitle').textContent = chat.name;
            document.getElementById('chatAvatar').textContent = chat.avatar;
            document.getElementById('chatStatus').textContent = 
                chat.type === 'contact' ? 
                (chat.online ? '‚óè –í —Å–µ—Ç–∏' : '‚óè –ù–µ –≤ —Å–µ—Ç–∏') :
                `üë• ${chat.type === 'group' ? '–ì—Ä—É–ø–ø–æ–≤–æ–π —á–∞—Ç' : ''}`;
            
            // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –¥–µ–π—Å—Ç–≤–∏—è
            document.getElementById('chatActions').style.display = 'flex';
            document.getElementById('inputArea').style.display = 'block';
            
            // –û–±–Ω–æ–≤–ª—è–µ–º —Å–ø–∏—Å–æ–∫ —á–∞—Ç–æ–≤
            updateChatsList();
            
            // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º —Å–æ–æ–±—â–µ–Ω–∏—è
            showMessages();
        }
        
        function showMessages() {
            if (!currentChat) return;
            
            const container = document.getElementById('messages');
            const chatMessages = messages[currentChat.id] || [];
            
            container.innerHTML = '';
            
            if (chatMessages.length === 0) {
                container.innerHTML = `
                    <div class="empty-chat">
                        <h3>–ù–∞—á–Ω–∏—Ç–µ –æ–±—â–µ–Ω–∏–µ!</h3>
                        <p>–û—Ç–ø—Ä–∞–≤—å—Ç–µ –ø–µ—Ä–≤–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ</p>
                    </div>
                `;
                return;
            }
            
            chatMessages.forEach(msg => {
                const div = document.createElement('div');
                div.className = `message ${msg.isMe ? 'out' : 'in'}`;
                div.innerHTML = `
                    <div>${msg.text}</div>
                    <div class="message-info">
                        <span>${msg.sender}</span>
                        <span>${msg.time}</span>
                    </div>
                `;
                container.appendChild(div);
            });
            
            container.scrollTop = container.scrollHeight;
        }
        
        // ========== –°–û–û–ë–©–ï–ù–ò–Ø ==========
        function sendMessage() {
            if (!currentChat) {
                showNotification('‚ùå –í—ã–±–µ—Ä–∏—Ç–µ —á–∞—Ç');
                return;
            }
            
            const input = document.getElementById('messageInput');
            const text = input.value.trim();
            if (!text) return;
            
            const time = new Date().toLocaleTimeString([], { hour: '2-digit', minute: '2-digit' });
            
            // –°–æ—Ö—Ä–∞–Ω—è–µ–º —Å–æ–æ–±—â–µ–Ω–∏–µ
            if (!messages[currentChat.id]) {
                messages[currentChat.id] = [];
            }
            
            messages[currentChat.id].push({
                text: text,
                sender: myName,
                time: time,
                isMe: true
            });
            
            // –û—á–∏—â–∞–µ–º –ø–æ–ª–µ
            input.value = '';
            
            // –û–±–Ω–æ–≤–ª—è–µ–º UI
            showMessages();
            updateChatsList();
            saveData();
            
            // –ò–º–∏—Ç–∞—Ü–∏—è –æ—Ç–≤–µ—Ç–∞ (–≤ —Ä–µ–∞–ª—å–Ω–æ–º –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–∏ –∑–¥–µ—Å—å –±—ã–ª –±—ã P2P)
            if (currentChat.type === 'contact' && currentChat.online) {
                setTimeout(() => {
                    const replies = [
                        "–ü—Ä–∏–≤–µ—Ç!",
                        "–•–æ—Ä–æ—à–æ!)",
                        "–ö–∞–∫ —Å–∞–º?",
                        "–°–ª—É—à–∞—é —Ç–µ–±—è",
                        "–û—Ç–ª–∏—á–Ω–æ!"
                    ];
                    const reply = replies[Math.floor(Math.random() * replies.length)];
                    const replyTime = new Date().toLocaleTimeString([], { hour: '2-digit', minute: '2-digit' });
                    
                    messages[currentChat.id].push({
                        text: reply,
                        sender: currentChat.name,
                        time: replyTime,
                        isMe: false
                    });
                    
                    showMessages();
                    updateChatsList();
                    saveData();
                    showNotification(`üí¨ ${currentChat.name}: ${reply}`);
                }, 1000);
            }
        }
        
        // ========== –ù–ê–°–¢–†–û–ô–ö–ò ==========
        function toggleSettings() {
            const panel = document.getElementById('settingsPanel');
            panel.style.display = panel.style.display === 'none' ? 'flex' : 'none';
        }
        
        function saveProfile() {
            const newName = document.getElementById('profileName').value.trim();
            if (newName && newName.length > 0) {
                myName = newName;
                document.getElementById('userName').textContent = myName;
                saveData();
                showNotification('‚úÖ –ü—Ä–æ—Ñ–∏–ª—å —Å–æ—Ö—Ä–∞–Ω—ë–Ω');
            }
        }
        
        function saveAllSettings() {
            // –°–æ—Ö—Ä–∞–Ω—è–µ–º –≤—Å–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏
            settings.theme = document.getElementById('themeSelect').value;
            settings.fontSize = parseInt(document.getElementById('fontSize').value);
            settings.sound = document.getElementById('soundToggle').checked;
            settings.vibrate = document.getElementById('vibrateToggle').checked;
            settings.onlineStatus = document.getElementById('onlineStatusToggle').checked;
            settings.readReceipts = document.getElementById('readReceiptsToggle').checked;
            settings.autoAnswer = document.getElementById('autoAnswerToggle').checked;
            settings.noiseSuppression = document.getElementById('noiseSuppressionToggle').checked;
            settings.echoCancellation = document.getElementById('echoCancellationToggle').checked;
            settings.autoDelete = document.getElementById('autoDelete').value;
            settings.saveMedia = document.getElementById('saveMediaToggle').checked;
            settings.dataUsage = document.getElementById('dataUsage').value;
            
            // –ü—Ä–∏–º–µ–Ω—è–µ–º
            applySettings();
            saveData();
            showNotification('‚úÖ –ù–∞—Å—Ç—Ä–æ–π–∫–∏ —Å–æ—Ö—Ä–∞–Ω–µ–Ω—ã');
        }
        
        // –°–ª—É—à–∞–µ–º –∏–∑–º–µ–Ω–µ–Ω–∏—è –Ω–∞—Å—Ç—Ä–æ–µ–∫
        document.querySelectorAll('#settingsPanel input, #settingsPanel select').forEach(el => {
            el.addEventListener('change', saveAllSettings);
        });
        
        // ========== –ö–û–ù–¢–ê–ö–¢–´ –ò –ì–†–£–ü–ü–´ ==========
        function showAddModal() {
            document.getElementById('addModal').classList.add('active');
        }
        
        function showAddContactModal() {
            document.getElementById('addModal').classList.remove('active');
            document.getElementById('addContactModal').classList.add('active');
        }
        
        function showCreateGroupModal() {
            document.getElementById('addModal').classList.remove('active');
            document.getElementById('createGroupModal').classList.add('active');
        }
        
        function addContact() {
            const id = document.getElementById('contactId').value.trim();
            const name = document.getElementById('contactName').value.trim() || `–î—Ä—É–≥ (${id.substring(0, 6)})`;
            
            if (!id) {
                showNotification('‚ùå –í–≤–µ–¥–∏—Ç–µ ID –¥—Ä—É–≥–∞');
                return;
            }
            
            if (id === myId) {
                showNotification('‚ùå –ù–µ–ª—å–∑—è –¥–æ–±–∞–≤–∏—Ç—å —Å–∞–º–æ–≥–æ —Å–µ–±—è');
                return;
            }
            
            if (contacts.find(c => c.id === id)) {
                showNotification('‚ùå –≠—Ç–æ—Ç –∫–æ–Ω—Ç–∞–∫—Ç —É–∂–µ –¥–æ–±–∞–≤–ª–µ–Ω');
                return;
            }
            
            contacts.push({
                id: id,
                name: name,
                avatar: name.charAt(0),
                online: false
            });
            
            hideModal();
            updateChatsList();
            saveData();
            showNotification(`üë§ –ö–æ–Ω—Ç–∞–∫—Ç "${name}" –¥–æ–±–∞–≤–ª–µ–Ω`);
        }
        
        function createGroup() {
            const name = document.getElementById('groupName').value.trim();
            const membersInput = document.getElementById('groupMembers').value.trim();
            
            if (!name) {
                showNotification('‚ùå –í–≤–µ–¥–∏—Ç–µ –Ω–∞–∑–≤–∞–Ω–∏–µ –≥—Ä—É–ø–ø—ã');
                return;
            }
            
            const groupId = 'GRP-' + Math.random().toString(36).substring(2, 8).toUpperCase();
            const members = ['–í—ã'];
            
            if (membersInput) {
                membersInput.split(',').forEach(id => {
                    const trimmed = id.trim();
                    if (trimmed && trimmed !== myId) {
                        members.push(`–£—á–∞—Å—Ç–Ω–∏–∫ (${trimmed.substring(0, 6)})`);
                    }
                });
            }
            
            groups.push({
                id: groupId,
                name: name,
                avatar: name.charAt(0),
                members: members,
                online: members.length
            });
            
            hideModal();
            updateChatsList();
            saveData();
            showNotification(`üë®‚Äçüë©‚Äçüëß‚Äçüë¶ –ì—Ä—É–ø–ø–∞ "${name}" —Å–æ–∑–¥–∞–Ω–∞`);
        }
        
        // ========== –ó–í–û–ù–ö–ò ==========
        function startCall() {
            if (!currentChat) {
                showNotification('‚ùå –í—ã–±–µ—Ä–∏—Ç–µ —á–∞—Ç');
                return;
            }
            
            document.getElementById('callPanel').classList.add('active');
            document.getElementById('callTo').textContent = currentChat.name;
            
            // –ó–∞–ø—É—Å–∫–∞–µ–º —Ç–∞–π–º–µ—Ä
            let seconds = 0;
            const timer = setInterval(() => {
                seconds++;
                const min = Math.floor(seconds / 60).toString().padStart(2, '0');
                const sec = (seconds % 60).toString().padStart(2, '0');
                document.getElementById('callTimer').textContent = `${min}:${sec}`;
            }, 1000);
            
            // –°–æ—Ö—Ä–∞–Ω—è–µ–º ID —Ç–∞–π–º–µ—Ä–∞ –¥–ª—è –æ—Å—Ç–∞–Ω–æ–≤–∫–∏
            document.getElementById('callPanel').dataset.timer = timer;
            
            showNotification(`üìû –ó–≤–æ–Ω–æ–∫ ${currentChat.name}...`);
        }
        
        function acceptCall() {
            showNotification('‚úÖ –ó–≤–æ–Ω–æ–∫ –ø—Ä–∏–Ω—è—Ç');
        }
        
        function endCall() {
            const timer = document.getElementById('callPanel').dataset.timer;
            if (timer) clearInterval(parseInt(timer));
            
            document.getElementById('callPanel').classList.remove('active');
            document.getElementById('callTimer').textContent = '00:00';
            showNotification('üìû –ó–≤–æ–Ω–æ–∫ –∑–∞–≤–µ—Ä—à—ë–Ω');
        }
        
        function toggleMute() {
            showNotification('üé§ –ú–∏–∫—Ä–æ—Ñ–æ–Ω –ø–µ—Ä–µ–∫–ª—é—á–µ–Ω');
        }
        
        // ========== –í–°–ü–û–ú–û–ì–ê–¢–ï–õ–¨–ù–´–ï ==========
        function copyMyId(e) {
            if (e) e.stopPropagation();
            
            navigator.clipboard.writeText(myId)
                .then(() => showNotification('‚úÖ ID —Å–∫–æ–ø–∏—Ä–æ–≤–∞–Ω! –û—Ç–ø—Ä–∞–≤—å –¥—Ä—É–≥—É'))
                .catch(() => {
                    const input = document.createElement('input');
                    input.value = myId;
                    document.body.appendChild(input);
                    input.select();
                    document.execCommand('copy');
                    document.body.removeChild(input);
                    showNotification('‚úÖ ID —Å–∫–æ–ø–∏—Ä–æ–≤–∞–Ω!');
                });
        }
        
        function hideModal() {
            document.querySelectorAll('.modal').forEach(modal => {
                modal.classList.remove('active');
            });
        }
        
        function showNotification(text) {
            const notification = document.getElementById('notification');
            notification.querySelector('#notificationText').textContent = text;
            notification.classList.add('show');
            
            setTimeout(() => {
                notification.classList.remove('show');
            }, 3000);
        }
        
        function switchMenu(menu) {
            document.querySelectorAll('.menu-item').forEach(item => {
                item.classList.remove('active');
            });
            event.target.closest('.menu-item').classList.add('active');
            
            // –ó–¥–µ—Å—å –º–æ–∂–Ω–æ –¥–æ–±–∞–≤–∏—Ç—å –ª–æ–≥–∏–∫—É –ø–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏—è –º–µ–∂–¥—É —á–∞—Ç–∞–º–∏/–∫–æ–Ω—Ç–∞–∫—Ç–∞–º–∏/–≥—Ä—É–ø–ø–∞–º–∏
        }
        
        function clearChat() {
            if (!currentChat) return;
            
            if (confirm('–û—á–∏—Å—Ç–∏—Ç—å –∏—Å—Ç–æ—Ä–∏—é —á–∞—Ç–∞?')) {
                messages[currentChat.id] = [];
                showMessages();
                updateChatsList();
                saveData();
                showNotification('üóëÔ∏è –ò—Å—Ç–æ—Ä–∏—è –æ—á–∏—â–µ–Ω–∞');
            }
        }
        
        function exportData() {
            const data = {
                contacts,
                groups,
                messages,
                settings,
                myName,
                exportDate: new Date().toISOString()
            };
            
            const blob = new Blob([JSON.stringify(data, null, 2)], { type: 'application/json' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `p2p-messenger-backup-${new Date().toISOString().split('T')[0]}.json`;
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
            URL.revokeObjectURL(url);
            
            showNotification('üì§ –î–∞–Ω–Ω—ã–µ —ç–∫—Å–ø–æ—Ä—Ç–∏—Ä–æ–≤–∞–Ω—ã');
        }
        
        function clearAllData() {
            if (confirm('–£–î–ê–õ–ò–¢–¨ –í–°–ï –î–ê–ù–ù–´–ï? –≠—Ç–æ –¥–µ–π—Å—Ç–≤–∏–µ –Ω–µ–ª—å–∑—è –æ—Ç–º–µ–Ω–∏—Ç—å!')) {
                localStorage.removeItem('p2p-messenger-data');
                contacts = [];
                groups = [];
                messages = {};
                currentChat = null;
                
                updateChatsList();
                document.getElementById('messages').innerHTML = `
                    <div class="empty-chat">
                        <h3>üëã –î–æ–±—Ä–æ –ø–æ–∂–∞–ª–æ–≤–∞—Ç—å –≤ P2P –ú–µ—Å—Å–µ–Ω–¥–∂–µ—Ä!</h3>
                        <p>–í–∞—à ID: <strong>${myId}</strong></p>
                        <p style="margin-top: 20px;">–û—Ç–ø—Ä–∞–≤—å—Ç–µ —ç—Ç–æ—Ç ID –¥—Ä—É–≥—É –¥–ª—è –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è</p>
                    </div>
                `;
                
                document.getElementById('chatActions').style.display = 'none';
                document.getElementById('inputArea').style.display = 'none';
                
                showNotification('üóëÔ∏è –í—Å–µ –¥–∞–Ω–Ω—ã–µ –æ—á–∏—â–µ–Ω—ã');
            }
        }
        
        function showAbout() {
            document.getElementById('aboutModal').classList.add('active');
        }
        
        // ========== –ó–ê–ü–£–°–ö ==========
        document.addEventListener('DOMContentLoaded', init);
    </script>
</body>
</html>